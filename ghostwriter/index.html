<!DOCTYPE HTML>
<HTML xmlns="http://www.w3.org/1999/xhtml"
      xmlns:og="http://ogp.me/ns#"
      xmlns:fb="http://www.facebook.com/2008/fbml">
<HEAD>
	<meta http-equiv="Content-type" content="text/html;charset=UTF-8"/>
	<TITLE>Ghost Writer QnA</TITLE>
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />

	<meta property="og:site_name" content="Find My Cite"/>
    <meta property="og:type" content="website"/>
  	<meta property="og:title" content="Ghost Writed QnA"/>
  	<meta property="og:description" content="Are you a Zotero user? Do you ever wish you could search your libraries by idea not keywords? What about the ability to ask questions of your texts? Then this page is for you. Download information from one of your group libraries and interact with it using a number of NLP tools."/>
  	<meta property="og:image" content="images/thefuture.png"/>

	<script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
	<script src="../js/spin.min.js"></script>

	<link rel="stylesheet" type="text/css" href="css/main.css?v=2023-05-10.13:09">
	<script src="js/main.js?v=2023-05-10.13:09"></script>


</HEAD>

<BODY BGCOLOR="#ffffff" BACKGROUND="" MARGINWIDTH="0" MARGINHEIGHT="0">
<FORM ID="QNAFORM" NAME="QNAFORM" ACTION="https://www.qnamarkup.org/" METHOD="POST" accept-charset="UTF-8">
<div id="loading" style="display:none;position:absolute;z-index:100;width:100%;">
<div style="background:yellow;padding:8px 10px;margin:5px auto;width:100px;text-align:center;">
loading...
</div></div>

<div style="position:absolute;top:15px;left:25px;right:25px;overflow:hidden;">
	<span id="menu" style="float:right;">
		<a id="menu_bs" href="../?#bs">ðŸ¤– BS</a>&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;
		<a id="menu_find" href="../?#find">Find</a>&nbsp;&nbsp;&nbsp;
		<a id="menu_ask" href="../?#ask">Ask</a>&nbsp;&nbsp;&nbsp;
		<a id="menu_suggest" href="../?#suggest">Suggest</a>&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;
		<b>Ghost Write</b>&nbsp;&nbsp;&nbsp;
		<a id="menu_guess" href="../?#guess">Guess</a>&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;
		<a id="menu_settings" href="../?#settings">Library</a>
	</span>
	<font class="header">Find My Cite</font> <sup><font color="gray" size=-2>BETA</font></sup>
</div>
<div class="titleNtabs" style="position:absolute;top:50px;left:25px;right:25px;overflow:hidden;">
	<div class="tab_line"><font class="tabtext">&nbsp;</font></div>
</div>

<input id="tabselect" name="tabselect" type="hidden" value="1"/>
<input id="new" name="new" type="hidden" value="0"/>
<div class="titleNtabs" style="position:absolute;top:50px;left:25px;min-width:300px;overflow:hidden;">
	<div id="tab01" class="tab_top"><a href="javascript:void('');" onClick="tabtoggle('tab01');" class="tabtext">Document Specs</a></div>
	<div id="tab02" class="tab"><a href="javascript:void('');" onClick="tabtoggle('tab02');" class="tabtext">Draft</a></div>
	<div style="float:left;margin: 0 0 0 15px;">
		<select id="source" name="source" onClick="load_specs(document.getElementById(this.value).value);" class="example">
			<option value="no_action">Load Template</option>
			<option value="news_article">News Article</option>
			<option value="journal_entry">Journal Entry</option>
			<!--<option value="five_paragraph_essay">5 Â¶ Essay</option>-->
			<option value="short_poem">Short Poem</option>
		</select>

		<input id="upload" type="file"/> 
		&nbsp;&nbsp;&nbsp;<a href="javascript:void('');" id="upload_link">Open</a>
		&nbsp;&nbsp;<a href="javascript:void('');" id="upload_link" onClick="saveTextAsFile('markup','ghostwriterQnA.txt');">Save</a>
		&nbsp;&nbsp;<a href="javascript:void('');" onClick="load_specs(document.getElementById('template_new').value);">New</a>
	</div>
</div>

<div id="codeblock">
	<textarea id=markup name=markup style="box-sizing: border-box;width:100%;height:100%;border: solid 1px #aaa;resize: none;padding:10px;" onkeydown="insertTab(this, event);" wrap="off">
	</textarea>
</div>

<div id="draftblock" style="display:none;">
	<textarea id=draft name=draft wrap="on" disabled></textarea>
	<div id='draft_instructions'>Looking to edit this draft? Make your changes in <i>Document Specs</i> or copy to a text editor.</div>
</div>

<div style="position:absolute;height:30px;bottom:25px;left:25px;right:25px;">

	<div id="wrap_box" >
		<label><input type=checkbox id="wrap" name="wrap" value="1" onChange="toggle_wrap('');" /> word wrap</label>&nbsp;&nbsp; 
	</div>
	<label><input type=checkbox id="beep" name="beep" value="1" onChange="toggle_beep('');" /> beep when done</label>&nbsp;&nbsp;&nbsp;&nbsp;
	<a id="tos" href="https://findmycite.org#tos" target="_blank">terms &amp; privacy</a> | 
	<a href="mailto:litlab@suffolk.edu" >contact</a>

	<a href="https://suffolklitlab.org/" alt="LIT Lab" target="_blank"><img src="../images/lit_suffolk.png" class="footer_logo" border="0" alt="LIT and Suffolk University Law School Logos" style="height:35px;" align="right"/></a>

</div>
</FORM>

<div id="right_panel">
<div style="box-sizing: border-box;float:left;height:100%;width:100%;border:#ffffff 1px solid;margin-left:10px;overflow: hidden;">
	<div id="video" style="box-sizing: border-box;float:left;width:100%;">
		<center><img id="intro_vid_0" class="embed_vid" src="../images/video_coming_soon.png"></center>
		<!--<iframe id="intro_vid_0" class="embed_vid" src="https://www.youtube-nocookie.com/embed/qbPf9VRP6eU?rel=0" frameborder="0" gesture="media" allow="encrypted-media" allowfullscreen></iframe>-->
		<div style="box-sizing: border-box;float:left;width:100%;background:#eee;text-align: center;padding:4px;z-index:1;">
			<a href="javascript:void('');" onClick="hide('video');show('hidden_video');$('#output_window').css('top','38px');localStorage.hidevideo=1;$('#output_window').scrollTop($('#output_window')[0].scrollHeight);" class="smallcap">hide video</a>
		</div>
	</div>
	<div id="hidden_video" style="box-sizing: border-box;display:none;float:left;width:100%;">
		<div style="box-sizing: border-box;float:left;width:100%;background:#eee;text-align: center;padding:3px;">
			<a href="javascript:void('');" onClick="show('video');hide('hidden_video');$('#output_window').css('top','calc(38px + 26cqw)');localStorage.hidevideo=0;$('#output_window').scrollTop($('#output_window')[0].scrollHeight)" class="smallcap">show video</a>
		</div>
	</div>

	<div id="output_window" style="box-sizing: border-box;position:absolute;left:11px;right:-9px;text-align:left;padding:0 15px;bottom:135px;top:calc(38px + 26cqw);background:rgb(255, 255, 255);overflow-y: scroll;border-left:#aaa solid 1px;">   
		<p style="text-align:center;background:#faef8e;padding:15px;margin:10px 0 0 0;border: 1px solid #888;">FWIW, the author of this site will discuss their work at this year's <a href="https://2023.calicon.org/sessions/findmyciteorg-llm-sandbox-legal-educators" target="_blank">CALIcon</a> (June 16, 2023).</p>
	</div>
	
	<div id="start_box" style="box-sizing: border-box;position:absolute;width:100%;padding:0px;height:125px;bottom:0px;text-align: center;">
		<input type="button" style="margin-top:5px;width:100%;height:30px;background:rgb(187, 186, 186)" value='Build from Document Specs' onclick="build_button();"/>
	</div>

	<div id="processing_box" style="display:none;box-sizing: border-box;position:absolute;width:100%;padding:0px;height:125px;bottom:0px;">
		<div id="spinner" style="position: relative; margin:0 auto;width:100px;background:white;">&nbsp;</div>
		<input type="button" style="margin-top:90px;width:100%;height:30px;background:rgb(187, 186, 186)" value='Exit' onclick="exit_button()"/>
	</div>

	<div id="answer_box" style="display:none;box-sizing: border-box;position:absolute;width:100%;padding:0px;height:125px;bottom:0px;text-align: center;">
		<textarea id="reply" name="reply" style="box-sizing: border-box;width:100%;height:80px;margin:0px;resize: none;"></textarea>
		<input id="answer_" type="button" style="margin-top:5px;width:43%;height:30px;background:rgb(187, 186, 186)" value='Answer' onclick="answer_button()"/>
		<input id="skip_" type="button" style="margin-top:5px;width:24%;height:30px;background:rgb(187, 186, 186)" value='Skip/Trash Q' onclick="skip_button()"/>
		<input id="suggest_" type="button" style="margin-top:5px;width:20%;height:30px;background:rgb(187, 186, 186)" value='Suggest A' onclick="suggest_button()"/>
		<input id="exit_" type="button" style="margin-top:5px;width:10%;height:30px;background:rgb(187, 186, 186)" value='Exit' onclick="exit_button()"/>
	</div>


</div>
</div>

<textarea id="five_paragraph_essay" style="display:none">{
"config": {
	"ghostwriterQnA_version": "0.1",
	"bottom_up_abstract": false,
	"include_section_headings": false,
	"max_discovery_questions": 3,
	"max_follow_up_questions": 1,
	"llm_temperature": 0.7,
	"verbose": false
},
"background": {
	"What type of document is this?": "A five paragraph essay.",
	"What is the project's goal?": null,
	"Who is the project's audience?": null,
	"What style should the project be written in?": null,
	"What is your thesis?": null,
	"What's your first main point?": null,
	"What's your second main point?": null,
	"What's your third main point?": null
},
"sections": {
	"Introduction": {
	"description": "The introduction is the first paragraph of the essay, and it serves several purposes. This paragraph gets your reader's attention, develops the basic ideas of what you will cover, and provides the thesis statement for the essay. The thesis statement is usually only one sentence and is made up of the topic, focus, and three main points of the essay.",
	"approx_length_in_words": 250,
	"discovery_questions": [],
	"summary": null,
	"text": null
	},
	"First Point": {
	"description": "A paragraph addressing your first main point. Each body paragraph should start with a transition \u2014 either a word or phrase, like First, or Another important point is. Then, the first sentence should continue with your topic sentence. The topic sentence tells your reader what the paragraph is about, like a smaller-level thesis statement. The rest of the paragraph will be made of supporting sentences. These sentences, at least four of them, will explain your topic sentence to your reader.",
	"approx_length_in_words": 250,
	"discovery_questions": [],
	"summary": null,
	"text": null
	},
	"Second Point": {
	"description": "A paragraph addressing your second main point. Each body paragraph should start with a transition \u2014 either a word or phrase, like First, or Another important point is. Then, the first sentence should continue with your topic sentence. The topic sentence tells your reader what the paragraph is about, like a smaller-level thesis statement. The rest of the paragraph will be made of supporting sentences. These sentences, at least four of them, will explain your topic sentence to your reader.",
	"approx_length_in_words": 250,
	"discovery_questions": [],
	"summary": null,
	"text": null
	},
	"Third Point": {
	"description": "A paragraph addressing your third main point. Each body paragraph should start with a transition \u2014 either a word or phrase, like First, or Another important point is. Then, the first sentence should continue with your topic sentence. The topic sentence tells your reader what the paragraph is about, like a smaller-level thesis statement. The rest of the paragraph will be made of supporting sentences. These sentences, at least four of them, will explain your topic sentence to your reader.",
	"approx_length_in_words": 250,
	"discovery_questions": [],
	"summary": null,
	"text": null
	},
	"Conclusion": {
	"description": "The conclusion is the last paragraph of the essay. This paragraph brings the essay to a close, reminds the reader of the basic ideas from the essay, and restates the thesis statement. The conclusion should not contain new ideas, as it is the summation of the content of the essay. The restatement of the thesis is a simpler form that the one originally presented in the introduction.",
	"approx_length_in_words": 250,
	"discovery_questions": [],
	"summary": null,
	"text": null
	}
},
"coherent_body": null,
"abstract": null,
"draft_document": null
}</textarea>


<textarea id="journal_entry" style="display:none">{
  "config": {
    "ghostwriterQnA_version": "0.1",
    "bottom_up_abstract": true,
    "include_section_headings": true,
    "max_discovery_questions": 3,
    "max_follow_up_questions": 1,
    "llm_temperature": 0.7,
    "verbose": false
  },
  "framing": "You are helping someone write a short journal entry in which they reflect on their past week. Your job is to collect information and write a first draft.",
  "background": {
    "How comfortable did you feel brainstorming in front of the team this week?": null,
    "When your fellow team members said they'd get something done, did they?": null,
    "Did you start the week knowing what your goals were and how to reach them?": null,
    "What worked well this week?": null,
    "What didn't work well this week?": null,
    "Can you think of anything new we should try. If so, what?": null
  },
  "sections": {
    "General": {
      "description": "A reflective journal entry exploring the issues found in the background information.",
      "approx_length_in_words": 500,
      "discovery_questions": [],
      "summary": null,
      "text": null
    },
    "Specific": {
      "description": "A deeper dive into an event from the week, maybe something discussed in the General section. This section should focus on how the event made the author feel and what they learned from the experience, either about themselves or the work.",
      "approx_length_in_words": 500,
      "discovery_questions": [],
      "summary": null,
      "text": null
    }
  },
  "coherent_body": null,
  "abstract": null,
  "draft_document": null
}</textarea>


<textarea id="news_article" style="display:none">{
  "config": {
    "ghostwriterQnA_version": "0.1",
    "bottom_up_abstract": false,
    "include_section_headings": false,
    "max_discovery_questions": 3,
    "max_follow_up_questions": 1,
    "llm_temperature": 0.7,
    "verbose": false
  },
  "framing": "You are helping someone write a news article. Your job is to collect information and write a first draft.",
  "background": {
    "What is today's date?": null,
    "Who?": null,
    "What?": null,
    "When?": null,
    "Where?": null,
    "How?": null
  },
  "sections": {
    "The Lead": {
      "description": "Provide the most important information here, sticking to the 5Ws and H (i.e., who, what, when, where, and how from the background information)",
      "approx_length_in_words": 250,
      "discovery_questions": [],
      "summary": null,
      "text": null
    },
    "The Body": {
      "description": "Build on the content found in the The Lead and background information. Provide detail and texture to events.",
      "approx_length_in_words": 250,
      "discovery_questions": [],
      "summary": null,
      "text": null
    },
    "The Tail": {
      "description": "Summarize the story and point to what's likely to happen next.",
      "approx_length_in_words": 200,
      "discovery_questions": [],
      "summary": null,
      "text": null
    }
  },
  "coherent_body": null,
  "abstract": null,
  "draft_document": null
}</textarea>

<textarea id="short_poem" style="display:none">{
  "config": {
    "ghostwriterQnA_version": "0.1",
    "bottom_up_abstract": false,
    "include_section_headings": false,
    "max_discovery_questions": 3,
    "max_follow_up_questions": 0,
    "llm_temperature": 0.9,
    "verbose": false
  },
  "framing": "You are helping write a short rhyming poem. Your job is to collect information and write a first draft.",
  "background": {
    "What topics and themes do you want the poem to grapple with?": null,
    "What metaphors do you want to explore?": null,
    "How would you like the reader to feel?": null
  },
  "sections": {
    "Poem": {
      "description": "A short rhyming poem exploring the topics, themes, and metaphors found in the background information.",
      "approx_length_in_words": 250,
      "discovery_questions": [],
      "summary": null,
      "text": null
    }
  },
  "coherent_body": null,
  "abstract": null,
  "draft_document": null
}</textarea>

<textarea id="template_new" style="display:none">{
  "config": {
    "ghostwriterQnA_version": "0.1",
    "bottom_up_abstract": false,
    "include_section_headings": false,
    "max_discovery_questions": 3,
    "max_follow_up_questions": 1,
    "llm_temperature": 0.7,
    "verbose": false
  },
  "framing": "You are helping write something. Your job is to collect information and help write a first draft.",
  "background": {
    "Background Question Goes Here": null
  },
  "sections": {
    "Section Name Goes Here": {
      "description": "Section Description Goes Here",
      "approx_length_in_words": 100,
      "discovery_questions": [],
      "summary": null,
      "text": null
    }
  },
  "coherent_body": null,
  "abstract": null,
  "draft_document": null
}</textarea>

<script type="text/javascript">

var running = 0; 
var current_section = "before times";

const BORDER_SIZE = 15;
const panel = document.getElementById("right_panel");
const panel_0a = document.getElementById("codeblock");
const panel_0b = document.getElementById("draftblock");
const intro_vid_0 = document.getElementById("intro_vid_0");
const intro_vid_1 = document.getElementById("intro_vid_1");

let m_pos;
function resize(e){
  const dx = m_pos - e.x;
  m_pos = e.x;
  panel_width = parseInt(getComputedStyle(panel, '').width)
  if (panel_width<410) {
	panel_width = 411;
  } else if ((window.innerWidth-panel_width)< 250) {
	panel_width = window.innerWidth - 251;
  }
  panel.style.width = (panel_width + dx) + "px";
  panel_0a.style.right = (panel_width + dx + 35) + "px";
  panel_0b.style.right = (panel_width + dx + 35) + "px";
  localStorage.panel_w = (panel_width + dx)
 // panel.intro_vid_0.height = (parseInt(getComputedStyle(panel, '').width) + dx)/2 + "px";
}

panel.addEventListener("mousedown", function(e){
  if (e.offsetX < BORDER_SIZE) {
    m_pos = e.x;
    document.addEventListener("mousemove", resize, false);
  }
}, false);

document.addEventListener("mouseup", function(){
    document.removeEventListener("mousemove", resize, false);
}, false);

// http://stackoverflow.com/a/11844403
var unsaved = false;
var sending = 0;
$("#markup").change(function(){ //trigers change in all input fields including text type
    unsaved = true;
	localStorage.specs=document.getElementById('markup').value
});
//function unloadPage(){
//    if(unsaved && sending != 1){
//			timeout = setTimeout(function() {
//				 $('#loading').hide();
//				 document.getElementById('new').value='0'
//			}, 1000);
//			return "You have unsaved changes. Do you want to leave this page and discard your changes or stay on this page?";
//    }
//}
//window.onbeforeunload = unloadPage;

// h/t http://answers.splunk.com/answers/125819/fill-textarea-from-a-file.html
 //External data file handling starts here
 var control = document.getElementById("upload");
     control.addEventListener("change", function(event){
		if (window.File && window.FileReader && window.FileList && window.Blob) {
			var reader = new FileReader();
			 reader.onload = function(event){
				 var contents = event.target.result;
				   load_specs(contents);
				   //loading();
				   //document.QNAFORM.submit();
			 };
			 reader.onerror = function(event){
				 console.error("File could not be read! Code " + event.target.error.code);
			 };
			 //console.log("Filename: " + control.files[0].name);
			 reader.readAsText(control.files[0]);
		} else {
			alert('This feature is not supported by your browser.');
		}
	 }, false);

function start_spinner(target_id) {
    var opts = {
      lines: 13, // The number of lines to draw
      length: 7, // The length of each line
      width: 5, // The line thickness
      radius: 15, // The radius of the inner circle
      corners: 1, // Corner roundness (0..1)
      rotate: 0, // The rotation offset
      color: '#000', // #rgb or #rrggbb
      speed: 1, // Rounds per second
      trail: 60, // Afterglow percentage
      shadow: false, // Whether to render a shadow
      hwaccel: false, // Whether to use hardware acceleration
      className: 'spinner', // The CSS class to assign to the spinner
      zIndex: 2e9, // The z-index (defaults to 2000000000)
      top: '20', // Top position relative to parent in px
      left: '25' // Left position relative to parent in px
    };
    var target = document.getElementById(target_id);
    var spinner = new Spinner(opts).spin(target);
  }

function load_specs(specs){
	if (specs!="no_action") {
		var go = 1;
		try {
			document.getElementById('draft').value = JSON.parse(specs)["draft_document"];
		}
		catch(err) {
			alert('There is an issue with your document specifications file.');
			go = 0;
		}
		if (go==1){
			document.getElementById('markup').value = specs;
			tabtoggle('tab01');
			$("#source").val('no_action');
			show('start_box');hide('processing_box');hide('answer_box');
		}
		$('#markup').prop('disabled', false);
		$('#markup').css('background','#fff');
		//$('#output_window').empty();
		$('#spinner').empty();
		localStorage.specs = specs
	}
}

function reply(specs,reply){
	$('#spinner').empty();
	start_spinner('spinner');
	hide('start_box');show('processing_box');hide('answer_box');
	hide('video');show('hidden_video');$('#output_window').css('top','38px');
	$('#markup').prop('disabled', true);
	$('#markup').css('background','#eee');
	//console.log(specs,reply);
	call_api(specs,reply);
}

function call_api(document_specs=null,reply=null) {

	running = 1;
	go = 1;
	try {
		document_specs = JSON.parse(document_specs);		
		document_specs["config"]["speedrun"] = false;
		document_specs["user_interactions"] = JSON.parse(localStorage.user_interactions);
	}
	catch(err) {
	alert('There was an issue with your document specifications file. Make sure that it is valid json.');
	go = 0;
	}

	if (go==1){

		var Data = { "document_specs":document_specs, "reply":reply }

		console.log(Data);

		var server = "https://tools.suffolklitlab.org"; // Production Server
		//var server = "http://127.0.0.1:10100"; // Local Testing Server

		$.ajax({
		type: "POST",
		url: server + "/ghostwriter/",
		data: JSON.stringify(Data),
		//data: Data,

		dataType: "json",
		crossDomain:true,
		// --- OR ---
		//dataType: "jsonp",
		//jsonpCallback: 'callback',

		contentType : "text/plain;charset=UTF-8",
		success: function(data) {
			if (running == 1) {

				console.log(current_section);
				console.log(data["output"]);

				if (data["output"]["type"]=="error message"){
						new_text = data["output"]["text"].replaceAll("\n", "<br>");
						$('#output_window').append("<div class='text_wrapper'><p class='output_text' style='background-color:#fee;'>"+new_text+"</p></div>");
						$('#output_window').append("<div class='text_wrapper'><p class='error'>there was an error</p></div>");
						$("#output_window").scrollTop($("#output_window")[0].scrollHeight);
						exit_button();
				} else {

					if (current_section != data["output"]["section"]) {
						current_section = data["output"]["section"];
						if (current_section=="background") {
							$('#output_window').append("<div class='text_wrapper'><p class='output_text'>Before we get into the body of our text, let's start with some background questions.</p></div>");
							$("#output_window").scrollTop($("#output_window")[0].scrollHeight);
						} else if (data["output"]["type"]!="ALL_DONE") {
							$('#output_window').append("<div class='text_wrapper'><p class='output_text'>The following questions will focus on info needed to write '"+current_section+"'. Here's the section's description:\n\n"+data["specs"]["sections"][current_section]["description"]+"</p></div>");
							$("#output_window").scrollTop($("#output_window")[0].scrollHeight);
						}
					}

					document.getElementById('draft').value = data["specs"];

					localStorage.user_interactions =  JSON.stringify(data["specs"]["user_interactions"])
					delete data["specs"]["user_interactions"]
					delete data["specs"]["config"]["speedrun"]
					document.getElementById('markup').value = JSON.stringify(data["specs"], null, 2);
					localStorage.specs=document.getElementById('markup').value
					document.getElementById('draft').value = data["specs"]["draft_document"];
					
					if (data["output"]["log"]){
							if (data["output"]["log"].trim()!="") {
								new_log = data["output"]["log"].replaceAll("\n", "<br>");
								$('#output_window').append("<div class='text_wrapper'><div class='progress' style='text-align:left'>Here's a look at our prompt(s)</div><p class='output_log'>"+new_log+"</p></div>");
								document_specs["user_interactions"]["log"] = "";
								localStorage.user_interactions = document_specs["user_interactions"];
							}
					} 

					if (data["output"]["type"]=="ALL_DONE"){
						$('#output_window').append("<div class='text_wrapper'><p class='output_text' style='background-color:#7fffb0;'>Your draft document is ready for review.</p></div>");
						$("#output_window").scrollTop($("#output_window")[0].scrollHeight);
						tabtoggle('tab02');
						exit_button();
					
					} else {

						new_text = data["output"]["text"].replaceAll("\n", "<br>");
						progress = data["output"]["max_possible_questions"] - data["output"]["answered_questions"];
						if (data["output"]["type"]=="follow up question") {
							followup_padding = "style='margin-left:25px;'";
						} else {
							followup_padding = "";
						}
						$('#output_window').append("<div class='progress'> â‰¤ "+progress+" questions remaining</div><div class='text_wrapper'><p class='output_text' "+followup_padding+">"+new_text+"</p></div>");
						$("#output_window").scrollTop($("#output_window")[0].scrollHeight);

						
						if (data["output"]["can_skip"]=="yes"){
							$("#skip_").prop("disabled",false);
						} else {
							$("#skip_").prop("disabled",true);
						}

						if (data["output"]["section"]=="background"){
							$("#suggest_").prop("disabled",true); 
						} else {
							$("#suggest_").prop("disabled",false); 
						}
						$("#exit_").prop("disabled",false); 

						if (data["output"]["suggestion"]){
							$('#output_window').append("<div class='text_wrapper'><p class='suggestion_info'>See textarea for suggestion...</p></div>");
							$("#output_window").scrollTop($("#output_window")[0].scrollHeight);
							document.getElementById('reply').value = data["output"]["suggestion"]
						}

						hide('start_box');
						hide('processing_box');
						show('answer_box');
						$('#reply').focus();
					
					}
				}
				beep();
			}
		},
		error: function (jqXHR, exception) {
			if (running == 1) {
				beep();
				$('#output_window').append("<div class='text_wrapper'><p class='error'>there was an error. please try again.</p></div>");
				$("#output_window").scrollTop($("#output_window")[0].scrollHeight);
				exit_button();
				//err = JSON.parse(jqXHR.responseText)
				//console.log(err)
			}
		}
		});
	} else {
		$('#output_window').append("<div class='text_wrapper'><p class='error'>there was an error</p></div>");
		$("#output_window").scrollTop($("#output_window")[0].scrollHeight);
		exit_button();
	}

}

$('#reply').keypress(function(e){
	if(e.keyCode == 13 && !e.shiftKey) {
		e.preventDefault();
		answer_button();
	}
});

function build_button() {
	current_section = "before times";
	hide('start_box');
	show('processing_box');
	hide('answer_box');
	document.getElementById('output_window').innerHTML='';
	reply(document.getElementById('markup').value,null);
	$('#answer_').css('background','rgb(187, 186, 186)');
	$('#answer_').val('Answer');
}

function answer_button() {
	if (document.getElementById('reply').value.trim()!="") {
		reply(document.getElementById('markup').value,document.getElementById('reply').value);
		$('#output_window').append("<div class='text_wrapper'><p class='input_text'>"+document.getElementById('reply').value+"</p></div>");
		document.getElementById('reply').value = ""
		$("#output_window").scrollTop($("#output_window")[0].scrollHeight);
	} else {
		alert("Your answer is blank. Please add text.")
	}
	$('#answer_').css('background','rgb(187, 186, 186)');
	$('#answer_').val('Answer');
}
function skip_button() {
	reply(document.getElementById('markup').value,'skip');
	$('#output_window').append("<div class='text_wrapper'><p class='input_text'>[skipping and removing question]</p></div>");
	document.getElementById('reply').value = ""
	$("#output_window").scrollTop($("#output_window")[0].scrollHeight);
	$('#answer_').css('background','rgb(187, 186, 186)');
	$('#answer_').val('Answer');
}
function suggest_button() {
	reply(document.getElementById('markup').value,'');
	$('#output_window').append("<div class='text_wrapper'><p class='input_text'>[asking for suggestion]</p></div>");
	document.getElementById('reply').value = ""
	$("#output_window").scrollTop($("#output_window")[0].scrollHeight);
	$('#answer_').css('background','orange');
	$('#answer_').val('Adopt (you can edit) & Answer');
}
function exit_button() {
	$('#answer_').css('background','rgb(187, 186, 186)');
	$('#answer_').val('Answer');
	running == 0;
	show('start_box');hide('processing_box');hide('answer_box');
	document.getElementById('reply').value = "";
	$('#markup').prop('disabled', false);
	$('#markup').css('background','#fff');
	localStorage.user_interactions = JSON.stringify({"skips":0,"interview":{},"log":""});
	$('#reply').focus();
}

function load_page() {

	localStorage.user_interactions =  JSON.stringify({"skips":0,"interview":{},"log":""});

	if (localStorage.specs){
		load_specs(localStorage.specs)
	} else {
		load_specs(document.getElementById("news_article").value)
	}
	
	if (localStorage.word_wrap == 1){
		$('#wrap').prop('checked', true);
	} else {
		$('#wrap').prop('checked', false);
	}
	toggle_wrap('');

	if (localStorage.beep == 1){
		$('#beep').prop('checked', true);
	} else {
		$('#beep').prop('checked', false);
	}
	toggle_beep('');

	if (localStorage.hidevideo==1) {
		hide('video');show('hidden_video');$('#output_window').css('top','38px');
	} else {
		show('video');hide('hidden_video');$('#output_window').css('top','calc(38px + 26cqw)');
	}

	panel_width = localStorage.panel_w
	if (panel_width<410) {
		panel_width = 411;
	} else if ((window.innerWidth-panel_width)< 250) {
		panel_width = window.innerWidth - 251;
	}
	localStorage.panel_w = panel_width
	document.getElementById("right_panel").style.width = localStorage.panel_w + "px";
	document.getElementById("codeblock").style.right = (parseInt(localStorage.panel_w) + 35) + "px";
	document.getElementById("draftblock").style.right = (parseInt(localStorage.panel_w) + 35) + "px";

}

function preloadFunc()
    {
        alert("PreLoad");
    }

window.onpaint = load_page();

</script>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-41WF20BW7V"></script>
<script>
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());

	gtag('config', 'G-41WF20BW7V');
</script>

</BODY>
</HTML>
